"""
2015 - Mike Schladt
Example plots all archetypes in database
"""

import MySQLdb 
import lib.mfv as mfv
import lib.config as CONST
import numpy
import json 
import sys

db_host = CONST.DB_HOST
db_user = CONST.DB_USER
db_pass = CONST.DB_PASS
db_name = CONST.DB_NAME

#establish database connection
connection = MySQLdb.connect(db_host, db_user, db_pass, db_name)
cursor = connection.cursor()
        

#find tag groupings
tag_groups = mfv.autogen_tag_groups()
machines = ['win7x32','win7x64']

#seperate by machine
for machine in machines : 
    for tags in tag_groups :
        #group name auto generated by tags and machine
        group_name = "{0}_{1}_{2}_{3}_{4}".format(tags[0][1],tags[1][1],tags[2][1],tags[3][1],machine)
        
        #retrieve features from the database
        cmd = "SELECT label,mean_features,stddev_features,max_value_features FROM archetypes WHERE label=%s"
        data = [group_name]
        
        cursor.execute(cmd, data)
        result = cursor.fetchone()
        
        #parse data from     
        label = result[0]
        mean_features = json.loads(result[1])
        stddev_features = json.loads(result[2])
        max_value_features = json.loads(result[3])
        
        #add features to FeatureVectors
        mean_vector = mfv.FeatureVector(None,None,None,mean_features)
        stddev_vector = mfv.FeatureVector(None,None,None,stddev_features)
        
        #add labels to vectors
        mean_vector.label = label+"_mean"
        stddev_vector.label = label+"_stddev"
        
        print mfv.plotly_scatter(None, mean_vector, stddev_vector, 'archetypes/' + group_name, None)
        